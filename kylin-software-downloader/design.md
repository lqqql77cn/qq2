# 银河麒麟软件下载助手 - 设计文档

## 应用概述

**银河麒麟软件下载助手**是一个安卓移动应用，用于为离线的银河麒麟系统打包软件及其依赖。该应用允许用户自定义下载源、选择软件清单、指定目标系统架构，并自动分析依赖关系进行打包。

---

## 屏幕列表

### 1. 首页 (Home Screen)
主导航界面，展示应用的核心功能入口。

**主要内容与功能：**
- 四个主要功能卡片：
  - 📥 "下载源管理" - 配置和管理软件下载源
  - 📋 "软件清单" - 选择需要下载的软件
  - ⚙️ "下载设置" - 配置目标系统和架构
  - 📦 "打包与下载" - 执行下载和打包操作
- 底部显示当前配置摘要（已配置的源数量、选中的软件数、目标架构）
- 快速开始按钮

### 2. 下载源管理屏幕 (Download Sources Screen)
管理多个软件下载源的界面。

**主要内容与功能：**
- 已配置源列表（卡片形式）
  - 源名称、URL、源类型（apt/yum/dnf等）
  - 编辑和删除按钮
  - 源状态指示（可用/不可用）
- 添加新源按钮（底部浮动按钮）
- 源优先级排序（拖拽或上下移动）

### 3. 添加/编辑下载源屏幕 (Add/Edit Source Screen)
表单界面，用于添加或编辑单个下载源。

**主要内容与功能：**
- 表单字段：
  - 源名称 (文本输入)
  - 源URL (文本输入)
  - 源类型选择 (Picker: apt/yum/dnf/自定义)
  - 用户名/密码 (可选，文本输入)
  - 启用/禁用切换
- 保存和取消按钮
- 测试连接按钮（验证源可用性）

### 4. 软件清单屏幕 (Software List Screen)
选择需要下载的软件包。

**主要内容与功能：**
- 搜索框（按名称搜索软件包）
- 软件包列表（FlatList）
  - 每个包显示：名称、版本、大小、依赖数量
  - 复选框用于选择/取消选择
  - 点击展开查看依赖详情
- 已选择计数器（顶部或底部）
- 全选/全不选按钮
- 清空选择按钮

### 5. 软件详情屏幕 (Software Detail Screen)
显示单个软件包的详细信息和依赖关系。

**主要内容与功能：**
- 软件基本信息：名称、版本、大小、描述
- 依赖树视图：
  - 显示直接依赖
  - 显示间接依赖（树形展示）
  - 依赖版本信息
- 选择此软件的复选框
- 返回按钮

### 6. 下载设置屏幕 (Download Settings Screen)
配置目标系统和下载参数。

**主要内容与功能：**
- 目标系统选择
  - 系统类型 (Picker: 银河麒麟/其他Linux)
  - 系统版本选择
- 目标架构选择（默认 arm64）
  - Radio 按钮组：arm64 (默认), armv7, x86_64, x86
- 下载保存目录选择
  - 显示当前选择的路径
  - "浏览" 按钮打开文件选择器
- 下载选项
  - 自动分析依赖 (切换开关，默认开启)
  - 下载后自动打包 (切换开关，默认开启)
  - 打包格式选择 (Picker: tar.gz/zip)
- 保存设置按钮

### 7. 打包与下载屏幕 (Download & Package Screen)
执行下载和打包操作的界面。

**主要内容与功能：**
- 配置摘要卡片：
  - 选中的软件数量和总大小
  - 预计依赖数量
  - 目标系统和架构
  - 保存目录
- 下载进度条
  - 总体进度百分比
  - 当前下载的软件名称
  - 当前文件进度
- 日志输出区域（可滚动）
  - 显示下载、依赖分析、打包过程的日志
- 开始下载按钮
- 暂停/继续按钮（下载中时显示）
- 取消按钮
- 下载完成后显示：
  - 打包文件路径
  - 分享按钮
  - 返回首页按钮

### 8. 设置屏幕 (Settings Screen)
应用全局设置。

**主要内容与功能：**
- 通用设置
  - 主题选择 (亮色/暗色/自动)
  - 语言选择 (中文/英文)
- 下载设置
  - 默认保存目录
  - 最大并发下载数
  - 超时时间设置
- 关于
  - 应用版本
  - 帮助文档链接
  - 反馈链接

---

## 主要用户流程

### 流程 1: 首次配置并下载软件
1. 用户打开应用 → 首页
2. 点击"下载源管理" → 下载源管理屏幕
3. 点击"添加新源" → 添加源屏幕
4. 输入源信息（名称、URL、类型）→ 保存
5. 返回首页
6. 点击"软件清单" → 软件清单屏幕
7. 搜索并选择需要的软件包 → 复选框勾选
8. 点击"下载设置" → 下载设置屏幕
9. 确认目标架构（默认 arm64）、选择保存目录 → 保存
10. 点击"打包与下载" → 打包与下载屏幕
11. 点击"开始下载" → 自动分析依赖、下载、打包
12. 下载完成 → 显示打包文件路径

### 流程 2: 编辑现有下载源
1. 首页 → "下载源管理"
2. 长按或点击源卡片上的编辑按钮 → 编辑源屏幕
3. 修改信息 → 保存
4. 返回下载源管理屏幕

### 流程 3: 查看软件依赖
1. 软件清单屏幕 → 点击软件包
2. 进入软件详情屏幕 → 查看依赖树
3. 返回软件清单屏幕

---

## 颜色方案

### 品牌色彩
- **主色 (Primary)**: `#0066CC` (蓝色) - 用于主要按钮、高亮、链接
- **成功色 (Success)**: `#22C55E` (绿色) - 用于成功状态、完成指示
- **警告色 (Warning)**: `#F59E0B` (橙色) - 用于警告、注意事项
- **错误色 (Error)**: `#EF4444` (红色) - 用于错误、删除操作
- **背景色 (Background)**: `#FFFFFF` (白色，亮色模式) / `#151718` (深灰，暗色模式)
- **表面色 (Surface)**: `#F5F5F5` (浅灰，亮色模式) / `#1E2022` (深灰，暗色模式)
- **文字色 (Foreground)**: `#11181C` (深灰，亮色模式) / `#ECEDEE` (浅灰，暗色模式)
- **辅助文字色 (Muted)**: `#687076` (灰色，亮色模式) / `#9BA1A6` (浅灰，暗色模式)
- **边框色 (Border)**: `#E5E7EB` (浅灰，亮色模式) / `#334155` (深灰，暗色模式)

### 设计原则
- 遵循 iOS Human Interface Guidelines (HIG)
- 单手操作友好：主要交互元素位于屏幕下半部分
- 清晰的视觉层级：使用颜色、大小、间距区分重要程度
- 深色模式支持：所有颜色自动适配亮色/暗色模式

---

## 技术架构

### 前端框架
- React Native + Expo 54
- Expo Router 用于导航
- NativeWind (Tailwind CSS) 用于样式
- TypeScript 用于类型安全

### 状态管理
- React Context + useReducer 用于全局状态（下载源、软件清单、设置）
- AsyncStorage 用于本地持久化

### 文件操作
- Expo FileSystem 用于文件读写和目录管理
- Expo DocumentPicker 用于目录选择

### 网络请求
- Axios 用于 HTTP 请求
- 支持多源并发下载

### 数据存储
- AsyncStorage 用于应用配置和历史记录
- 本地文件系统用于缓存和打包

---

## 核心功能实现要点

1. **多源管理**：支持添加、编辑、删除、排序多个下载源
2. **依赖分析**：自动解析软件包的依赖关系，递归获取间接依赖
3. **智能打包**：将选中的软件及其依赖打包为 tar.gz 或 zip 格式
4. **进度追踪**：实时显示下载进度、日志输出
5. **错误处理**：网络错误、文件操作错误的优雅处理和提示
6. **离线支持**：所有配置本地保存，支持离线浏览已配置的源和软件清单

---

## 用户界面风格

- **设计语言**：iOS-inspired，简洁、现代
- **间距**：统一使用 8px 基础单位的倍数
- **圆角**：卡片和按钮使用 12-16px 圆角
- **字体**：系统默认字体，清晰易读
- **图标**：使用 Material Icons，配合文字标签
- **动画**：简约的过渡动画，避免过度装饰
